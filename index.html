<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japon : L'Itin√©raire Ultime</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 500px;
        }
        /* Style pour la carte */
        #main-map {
            z-index: 1;
            height: 450px;
            width: 100%;
            border-radius: 0.75rem; /* rounded-xl */
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased selection:bg-indigo-100 selection:text-indigo-900">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="app.goHome()">
                <span class="text-2xl">üáØüáµ</span>
                <h1 class="text-xl font-bold tracking-tight text-stone-900 hidden md:block">Japon <span class="text-indigo-600 font-light">Slow Travel</span></h1>
                <h1 class="text-xl font-bold tracking-tight text-stone-900 md:hidden">Japon <span class="text-indigo-600 font-light">Ultimate</span></h1>
            </div>
            <nav class="flex gap-4 text-sm font-medium text-stone-500 overflow-x-auto">
                <button onclick="app.goHome()" class="whitespace-nowrap hover:text-indigo-600 transition-colors">Vue d'ensemble</button>
                <button onclick="app.filterByRegion('all')" class="whitespace-nowrap hover:text-indigo-600 transition-colors">Explorer les 50+ Lieux</button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 min-h-screen">
        
        <div id="dashboard-view" class="space-y-12 animate-fade-in">
            
            <section class="text-center max-w-4xl mx-auto space-y-6">
                <h2 class="text-3xl md:text-5xl font-bold text-stone-900">Le Grand Tour</h2>
                <p class="text-lg text-stone-600 leading-relaxed">
                    Vous avez identifi√© <strong id="total-count-hero" class="text-indigo-600">0</strong> lieux d'exception. 
                    De la p√©ninsule isol√©e de Tsugaru au nord jusqu'aux for√™ts de Yakushima au sud, cet itin√©raire couvre tout le spectre du Japon.
                </p>
                <div class="flex flex-wrap justify-center gap-3 text-xs md:text-sm text-stone-500 font-mono">
                    <span class="px-3 py-1 bg-white border border-stone-200 rounded-full">üöÖ JR Pass 21 Jours Recommand√©</span>
                    <span class="px-3 py-1 bg-white border border-stone-200 rounded-full">üå∏ Saison : Printemps/Automne</span>
                </div>
            </section>

            <section class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="text-xl font-bold mb-4 text-stone-800 border-l-4 border-indigo-500 pl-3">ADN de votre Voyage</h3>
                        <p class="text-stone-600 mb-6 text-sm">
                            Combinaison de classiques urbains et de p√©pites rares. Le graphique montre une forte tendance vers le spirituel et la nature.
                        </p>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-indigo-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-indigo-600" id="stat-total-spots">0</div>
                                <div class="text-[10px] text-indigo-800 uppercase tracking-wide">Lieux</div>
                            </div>
                            <div class="bg-emerald-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-emerald-600" id="stat-nature-percent">0%</div>
                                <div class="text-[10px] text-emerald-800 uppercase tracking-wide">Nature</div>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-amber-600" id="stat-culture-percent">0%</div>
                                <div class="text-[10px] text-amber-800 uppercase tracking-wide">Culture</div>
                            </div>
                            <div class="bg-rose-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-rose-600" id="stat-regions-count">0</div>
                                <div class="text-[10px] text-rose-800 uppercase tracking-wide">R√©gions</div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="overviewChart"></canvas>
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                <h3 class="text-xl font-bold mb-4 text-stone-800 border-l-4 border-indigo-500 pl-3">Carte Interactive</h3>
                <div id="main-map" class="shadow-inner border border-stone-200"></div>
            </section>

            <section id="regions-section">
                <h3 class="text-xl font-bold mb-6 text-stone-800 border-l-4 border-indigo-500 pl-3">Vos Zones d'Exploration</h3>
                <div id="regions-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    </div>
            </section>
        </div>

        <div id="region-view" class="hidden space-y-8 animate-fade-in">
            <button onclick="app.goHome()" class="flex items-center text-sm text-stone-500 hover:text-indigo-600 transition-colors mb-4 group font-medium">
                <span class="group-hover:-translate-x-1 transition-transform mr-1">‚Üê</span> Retour Carte Globale
            </button>

            <div id="hub-header" class="bg-gradient-to-br from-stone-900 to-stone-800 text-white rounded-2xl p-6 md:p-10 shadow-xl relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex flex-wrap items-center gap-3 mb-4">
                        <span class="inline-block py-1 px-3 rounded bg-white/10 border border-white/20 text-white text-xs font-bold tracking-wider backdrop-blur-sm">R√âGION</span>
                        <span id="region-tag" class="text-stone-300 text-xs bg-black/30 px-2 py-1 rounded"></span>
                    </div>
                    <h2 id="region-title" class="text-3xl md:text-5xl font-bold mb-4 tracking-tight">Region Name</h2>
                    
                    <div class="flex flex-col md:flex-row gap-4 md:gap-8 mt-6">
                        <div class="bg-indigo-600/20 border border-indigo-500/30 p-4 rounded-lg backdrop-blur-md">
                            <p class="text-indigo-200 text-xs uppercase font-bold mb-1">Hub Principal</p>
                            <p id="hub-city" class="text-white text-xl font-semibold">City Name</p>
                        </div>
                        <div class="md:flex-1">
                            <p id="region-desc" class="text-stone-300 text-sm md:text-base leading-relaxed opacity-90">Description...</p>
                        </div>
                    </div>
                </div>
                <div class="absolute right-0 top-0 w-96 h-96 bg-indigo-500 rounded-full blur-[100px] opacity-20 mix-blend-screen pointer-events-none"></div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="lg:w-1/3 flex flex-col justify-center">
                        <h3 class="text-lg font-bold mb-2 text-stone-800">‚è±Ô∏è Radar Logistique</h3>
                        <p class="text-sm text-stone-600 mb-4">
                            Temps de transport (aller simple) depuis <span class="font-bold text-indigo-600 hub-name-span"></span>.
                        </p>
                        <div class="grid grid-cols-3 gap-2 text-center text-[10px] font-bold text-stone-500">
                            <div class="bg-emerald-50 p-2 rounded border border-emerald-100 text-emerald-700">PROCHE<br>&lt; 60m</div>
                            <div class="bg-amber-50 p-2 rounded border border-amber-100 text-amber-700">MOYEN<br>1h-2h</div>
                            <div class="bg-rose-50 p-2 rounded border border-rose-100 text-rose-700">LOIN<br>&gt; 2h</div>
                        </div>
                    </div>
                    <div class="lg:w-2/3 border-t lg:border-t-0 lg:border-l border-stone-100 pt-4 lg:pt-0 lg:pl-8">
                        <div class="chart-container">
                            <canvas id="logisticsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold mb-6 text-stone-800 flex items-center gap-2">
                    <span>üìç</span> Liste des Activit√©s
                </h3>
                <div id="activities-list" class="grid grid-cols-1 xl:grid-cols-2 gap-4">
                    </div>
            </div>
        </div>
    </main>

    <footer class="bg-stone-900 text-stone-400 py-8 mt-12 border-t border-stone-800">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-sm">G√©n√©r√© avec Canvas &bull; 50+ Lieux Trait√©s</p>
            <div class="flex gap-4 text-xl opacity-50">
                <span>‚õ©Ô∏è</span><span>üöÖ</span><span>üóª</span>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA WITH GEOCOORDINATES ---
        const rawData = [
            // KANTO
            { name: "Shinjuku", region: "Tokyo & Kanto", hub: "Tokyo", type: "Ville/Shopping", rating: 4.5, time: 0, desc: "N√©ons, foules, Godzilla head.", lat: 35.6938, lng: 139.7034 },
            { name: "Akihabara", region: "Tokyo & Kanto", hub: "Tokyo", type: "Ville/Geek", rating: 4.3, time: 15, desc: "√âlectronique et otaku.", lat: 35.6984, lng: 139.7731 },
            { name: "Ueno", region: "Tokyo & Kanto", hub: "Tokyo", type: "Culture/Parc", rating: 4.4, time: 20, desc: "Mus√©es et march√© Ameyoko.", lat: 35.7141, lng: 139.7741 },
            { name: "Ikebukuro", region: "Tokyo & Kanto", hub: "Tokyo", type: "Ville/Shopping", rating: 4.2, time: 25, desc: "Alternative √† Shinjuku.", lat: 35.7289, lng: 139.7118 },
            { name: "Kamakura (Ville)", region: "Tokyo & Kanto", hub: "Tokyo", type: "Culture/Temples", rating: 4.6, time: 60, desc: "Bouddha et temples zen.", lat: 35.3197, lng: 139.5502 },
            { name: "Kamakurak≈çk≈ç-Mae", region: "Tokyo & Kanto", hub: "Tokyo", type: "Photo/Anime", rating: 4.3, time: 75, desc: "Passage √† niveau Slam Dunk.", lat: 35.3067, lng: 139.5019 },
            { name: "Katori (Chiba)", region: "Tokyo & Kanto", hub: "Tokyo", type: "Culture/Tradition", rating: 4.4, time: 100, desc: "La 'Petite Edo' de Chiba.", lat: 35.8907, lng: 140.4992 },
            
            // FUJI
            { name: "Parc Oishi", region: "Mont Fuji", hub: "Kawaguchiko", type: "Nature/Vue", rating: 4.5, time: 20, desc: "Vue classique du Fuji avec fleurs.", lat: 35.5228, lng: 138.7441 },
            { name: "Chureito Pagoda", region: "Mont Fuji", hub: "Kawaguchiko", type: "Vue/Ic√¥ne", rating: 4.7, time: 30, desc: "Pagode + Cerisiers + Fuji.", lat: 35.5013, lng: 138.8013 },

            // KYOTO & CENTRAL
            { name: "Gion", region: "Kyoto", hub: "Kyoto", type: "Culture/Ville", rating: 4.5, time: 15, desc: "Quartier des Geishas.", lat: 35.0037, lng: 135.7778 },
            { name: "Ninna-ji", region: "Kyoto", hub: "Kyoto", type: "Temple/UNESCO", rating: 4.6, time: 30, desc: "C√©l√®bre pour cerisiers Omuro.", lat: 35.0280, lng: 135.7138 },
            { name: "Renge-ji", region: "Kyoto", hub: "Kyoto", type: "Temple/Jardin", rating: 4.7, time: 40, desc: "Joyau cach√© au nord.", lat: 35.0601, lng: 135.8041 },
            { name: "Kurama-dera", region: "Kyoto", hub: "Kyoto", type: "Montagne/Rando", rating: 4.6, time: 50, desc: "Temple mystique, terre des Tengu.", lat: 35.1182, lng: 135.7674 },
            { name: "Kifune Shrine", region: "Kyoto", hub: "Kyoto", type: "Sanctuaire/Eau", rating: 4.5, time: 60, desc: "Lanternes rouges sur escalier.", lat: 35.1227, lng: 135.7634 },
            { name: "Otagi Nenbutsuji", region: "Kyoto", hub: "Kyoto", type: "Temple/Art", rating: 4.8, time: 60, desc: "1200 statues de pierre.", lat: 35.0275, lng: 135.6617 },
            { name: "Hozugawa Boat", region: "Kyoto", hub: "Kyoto", type: "Activit√©/Nature", rating: 4.4, time: 30, desc: "Descente de rivi√®re.", lat: 35.0150, lng: 135.5800 },
            { name: "Nintendo Museum", region: "Kyoto", hub: "Kyoto", type: "Mus√©e/Geek", rating: 4.9, time: 20, desc: "Histoire de Nintendo √† Uji.", lat: 34.8916, lng: 135.7924 },
            { name: "Momiji-ya (Takao)", region: "Kyoto", hub: "Kyoto", type: "Restaurant", rating: 4.4, time: 50, desc: "D√Æner Kawadoko.", lat: 35.0560, lng: 135.6796 },

            // OSAKA / NARA
            { name: "USJ (Universal)", region: "Osaka & Nara", hub: "Osaka", type: "Parc", rating: 4.8, time: 20, desc: "Super Nintendo World.", lat: 34.6654, lng: 135.4323 },
            { name: "Wakayama City", region: "Osaka & Nara", hub: "Osaka", type: "Ville", rating: 4.0, time: 60, desc: "Porte d'entr√©e Koyasan.", lat: 34.2304, lng: 135.1707 },
            { name: "Kasuga-taisha", region: "Osaka & Nara", hub: "Nara", type: "Culture", rating: 4.6, time: 15, desc: "Sanctuaire aux lanternes.", lat: 34.6812, lng: 135.8484 },
            { name: "Wakakusayama", region: "Osaka & Nara", hub: "Nara", type: "Nature/Vue", rating: 4.5, time: 30, desc: "Vue panoramique sur Nara.", lat: 34.6896, lng: 135.8573 },
            { name: "≈åmihachiman", region: "Osaka & Nara", hub: "Kyoto", type: "Ville/Canaux", rating: 4.4, time: 40, desc: "Canaux historiques.", lat: 35.1386, lng: 136.0898 },

            // KYOTO MER
            { name: "Amanohashidate", region: "Kyoto Nord (Mer)", hub: "Miyazu", type: "Nature/Vue", rating: 4.4, time: 15, desc: "Pont vers le Ciel.", lat: 35.5683, lng: 135.1917 },
            { name: "Ine Fishing Village", region: "Kyoto Nord (Mer)", hub: "Miyazu", type: "Village", rating: 4.6, time: 60, desc: "Maisons-bateaux Funaya.", lat: 35.6729, lng: 135.2913 },

            // CHUGOKU
            { name: "Itsukushima (√éle)", region: "Hiroshima & Miyajima", hub: "Hiroshima", type: "√éle/Sacr√©", rating: 4.7, time: 50, desc: "√éle sacr√©e de Miyajima.", lat: 34.2960, lng: 132.3197 },
            { name: "Itsukushima-jinja", region: "Hiroshima & Miyajima", hub: "Hiroshima", type: "Sanctuaire", rating: 4.6, time: 50, desc: "Torii flottant.", lat: 34.2959, lng: 132.3198 },
            { name: "Daish≈ç-in", region: "Hiroshima & Miyajima", hub: "Hiroshima", type: "Temple", rating: 4.7, time: 65, desc: "Temple au pied du mont Misen.", lat: 34.2936, lng: 132.3168 },
            { name: "Etajima", region: "Hiroshima & Miyajima", hub: "Hiroshima", type: "√éle/V√©lo", rating: 4.2, time: 30, desc: "Cyclisme dans la baie.", lat: 34.2185, lng: 132.4578 },

            // YAMAGUCHI
            { name: "Rurik≈ç-ji", region: "Yamaguchi", hub: "Shin-Yamaguchi", type: "Temple", rating: 4.6, time: 30, desc: "Pagode √† 5 √©tages.", lat: 34.1883, lng: 131.4727 },
            { name: "Akiyoshido Cave", region: "Yamaguchi", hub: "Shin-Yamaguchi", type: "Grotte", rating: 4.6, time: 45, desc: "Immense grotte calcaire.", lat: 34.2272, lng: 131.3039 },
            { name: "Beppu Benten Pond", region: "Yamaguchi", hub: "Shin-Yamaguchi", type: "Nature", rating: 4.4, time: 60, desc: "Eau bleu cobalt.", lat: 34.2338, lng: 131.2520 },
            { name: "Motonosumi Shrine", region: "Yamaguchi", hub: "Shin-Yamaguchi", type: "Photo/Vue", rating: 4.5, time: 90, desc: "123 Torii rouges vers la mer.", lat: 34.4284, lng: 131.0567 },
            { name: "Mori Clan Burial", region: "Yamaguchi", hub: "Shin-Yamaguchi", type: "Histoire", rating: 4.5, time: 90, desc: "Lanternes de pierre √† Hagi.", lat: 34.4103, lng: 131.4172 },

            // KYUSHU
            { name: "Unzen Jigoku", region: "Ky≈´sh≈´ (Nord)", hub: "Nagasaki", type: "Volcan", rating: 4.5, time: 100, desc: "Champs de fumerolles.", lat: 32.7423, lng: 130.2604 },
            { name: "Takachiho Gorge", region: "Ky≈´sh≈´ (Centre)", hub: "Kumamoto", type: "Nature/Mythe", rating: 4.7, time: 150, desc: "Gorges volcaniques.", lat: 32.7168, lng: 131.3025 },
            { name: "Amanoiwato-jinja", region: "Ky≈´sh≈´ (Centre)", hub: "Kumamoto", type: "Mythe", rating: 4.5, time: 170, desc: "Grotte d'Amaterasu.", lat: 32.7388, lng: 131.3486 },
            { name: "Kusasenrigahama", region: "Ky≈´sh≈´ (Centre)", hub: "Kumamoto", type: "Volcan", rating: 4.6, time: 60, desc: "Prairie du Mont Aso.", lat: 32.8856, lng: 131.0506 },
            { name: "Kamishikimi Kumano", region: "Ky≈´sh≈´ (Centre)", hub: "Kumamoto", type: "Anime", rating: 4.8, time: 90, desc: "D√©cor de 'Hotarubi no Mori e'.", lat: 32.8378, lng: 131.1578 },

            // YAKUSHIMA
            { name: "Kokemusu Forest", region: "Yakushima", hub: "Miyanoura", type: "Nature", rating: 4.8, time: 60, desc: "For√™t de mousse.", lat: 30.3340, lng: 130.5286 },

            // ALPES & CHUBU
            { name: "Togakushi Shrine", region: "Alpes Japonaises", hub: "Nagano", type: "Montagne", rating: 4.6, time: 60, desc: "All√©e de c√®dres g√©ants.", lat: 36.7554, lng: 138.0838 },
            { name: "Jigokudani Park", region: "Alpes Japonaises", hub: "Nagano", type: "Singes", rating: 4.5, time: 50, desc: "Singes des neiges.", lat: 36.7324, lng: 138.4621 },
            { name: "Kamik≈çchi", region: "Alpes Japonaises", hub: "Matsumoto", type: "Rando", rating: 4.8, time: 90, desc: "Vall√©e alpine.", lat: 36.2527, lng: 137.6369 },
            { name: "Shirakawa-g≈ç", region: "Alpes Japonaises", hub: "Takayama", type: "Village", rating: 4.6, time: 75, desc: "Toits de chaume.", lat: 36.2566, lng: 136.9043 },
            { name: "Kanazawa (Ville)", region: "Alpes Japonaises", hub: "Kanazawa", type: "Ville", rating: 4.5, time: 0, desc: "Jardin Kenroku-en.", lat: 36.5613, lng: 136.6562 },
            { name: "Gifu (Ville)", region: "Alpes Japonaises", hub: "Gifu", type: "Ville", rating: 4.0, time: 0, desc: "Ch√¢teau de Gifu.", lat: 35.4233, lng: 136.7607 },

            // TOHOKU
            { name: "Takayama Inari", region: "Tohoku (Aomori)", hub: "Hirosaki", type: "Sanctuaire", rating: 4.6, time: 90, desc: "Torii rouges au nord.", lat: 40.9234, lng: 140.2974 },

            // ONSEN
            { name: "Takaragawa Onsen", region: "Gunma (Onsen)", hub: "Minakami", type: "Onsen", rating: 4.4, time: 30, desc: "Rotenburo mixte rivi√®re.", lat: 36.8441, lng: 139.0435 },
            { name: "Amagisou (Izu)", region: "Izu Peninsula", hub: "Atami", type: "Onsen", rating: 4.2, time: 60, desc: "Chutes Kawazu.", lat: 34.7936, lng: 138.9324 },
            { name: "Nachi Falls", region: "Wakayama (Sud)", hub: "Kii-Katsuura", type: "Nature", rating: 4.6, time: 30, desc: "Chute sacr√©e.", lat: 33.6756, lng: 135.8876 }
        ];

        // --- CONFIG ---
        const regionsData = {
            "Tokyo & Kanto": { desc: "M√©galopole et escapades historiques.", hub: "Tokyo", color: "indigo" },
            "Mont Fuji": { desc: "La r√©gion des 5 lacs.", hub: "Kawaguchiko", color: "sky" },
            "Kyoto": { desc: "Ancienne capitale.", hub: "Kyoto", color: "violet" },
            "Osaka & Nara": { desc: "Divertissement et cerfs.", hub: "Osaka", color: "amber" },
            "Kyoto Nord (Mer)": { desc: "C√¥t√© mer.", hub: "Miyazu", color: "teal" },
            "Hiroshima & Miyajima": { desc: "Histoire et sacr√©.", hub: "Hiroshima", color: "rose" },
            "Yamaguchi": { desc: "Grottes et torii.", hub: "Shin-Yamaguchi", color: "orange" },
            "Ky≈´sh≈´ (Nord)": { desc: "Volcans et histoire.", hub: "Nagasaki", color: "red" },
            "Ky≈´sh≈´ (Centre)": { desc: "Mythes et volcans.", hub: "Kumamoto", color: "emerald" },
            "Yakushima": { desc: "For√™ts mill√©naires.", hub: "Miyanoura", color: "green" },
            "Alpes Japonaises": { desc: "Neige et traditions.", hub: "Nagano", color: "slate" },
            "Tohoku (Aomori)": { desc: "Grand Nord sauvage.", hub: "Hirosaki", color: "cyan" },
            "Gunma (Onsen)": { desc: "Bains en montagne.", hub: "Minakami", color: "stone" },
            "Izu Peninsula": { desc: "Sources et mer.", hub: "Atami", color: "lime" },
            "Wakayama (Sud)": { desc: "P√®lerinage sacr√©.", hub: "Kii-Katsuura", color: "fuchsia" }
        };

        // --- PALETTE COULEURS (Tailwind 500/600) ---
        const colorPalette = {
            indigo: '#4f46e5',
            sky:    '#0ea5e9',
            violet: '#8b5cf6',
            amber:  '#f59e0b',
            teal:   '#14b8a6',
            rose:   '#f43f5e',
            orange: '#f97316',
            red:    '#ef4444',
            emerald:'#10b981',
            green:  '#22c55e',
            slate:  '#64748b',
            cyan:   '#06b6d4',
            stone:  '#78716c',
            lime:   '#84cc16',
            fuchsia:'#d946ef'
        };

        const app = {
            currentView: 'dashboard',
            map: null,
            
            init() {
                this.renderDashboard();
                this.renderOverviewChart();
                // Delay map render slightly to ensure container is ready
                setTimeout(() => this.renderMap(), 100);
            },

            goHome() {
                document.getElementById('dashboard-view').classList.remove('hidden');
                document.getElementById('region-view').classList.add('hidden');
                window.scrollTo(0, 0);
                // Force map resize when showing again
                if(this.map) { setTimeout(() => this.map.invalidateSize(), 100); }
            },

            filterByRegion(region) {
                document.getElementById('regions-section').scrollIntoView({ behavior: 'smooth' });
            },

            selectRegion(regionName) {
                document.getElementById('dashboard-view').classList.add('hidden');
                document.getElementById('region-view').classList.remove('hidden');
                this.renderRegionDetail(regionName);
                window.scrollTo(0, 0);
            },

            renderMap() {
                if (this.map) return;
                
                // Centr√© sur le Japon
                this.map = L.map('main-map').setView([36.2048, 138.2529], 5);

                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap &copy; CARTO',
                    subdomains: 'abcd',
                    maxZoom: 19
                }).addTo(this.map);

                rawData.forEach(spot => {
                    if (spot.lat && spot.lng) {
                        // 1. R√©cup√©rer la couleur de la r√©gion
                        const regionInfo = regionsData[spot.region];
                        const colorName = regionInfo ? regionInfo.color : 'slate';
                        const hexColor = colorPalette[colorName] || '#64748b';

                        // 2. Cr√©er un marqueur circulaire color√©
                        const m = L.circleMarker([spot.lat, spot.lng], {
                            radius: 8,              // Taille du point
                            fillColor: hexColor,    // Couleur de la r√©gion
                            color: '#ffffff',       // Bordure blanche
                            weight: 2,              // √âpaisseur bordure
                            opacity: 1,
                            fillOpacity: 0.9        // Opacit√© du remplissage
                        });

                        // 3. Popup (inchang√©e)
                        m.bindPopup(`
                            <div class="text-center font-sans">
                                <h4 class="font-bold" style="color: ${hexColor}">${spot.name}</h4>
                                <p class="text-xs text-gray-600 mb-2">${spot.type}</p>
                                <span class="text-[10px] text-white px-2 py-1 rounded" style="background-color: ${hexColor}">
                                    ${spot.region}
                                </span>
                            </div>
                        `);
                        
                        m.addTo(this.map);
                    }
                });
            },

            renderDashboard() {
                document.getElementById('total-count-hero').innerText = rawData.length;
                document.getElementById('stat-total-spots').innerText = rawData.length;
                document.getElementById('stat-regions-count').innerText = Object.keys(regionsData).length;

                const nature = rawData.filter(i => /nature|rando|volcan|montagne|jardin|vue|√Æle/i.test(i.type)).length;
                const culture = rawData.filter(i => /temple|sanctuaire|ville|histoire|mus√©e/i.test(i.type)).length;
                
                document.getElementById('stat-nature-percent').innerText = Math.round((nature/rawData.length)*100) + "%";
                document.getElementById('stat-culture-percent').innerText = Math.round((culture/rawData.length)*100) + "%";

                const grid = document.getElementById('regions-grid');
                grid.innerHTML = '';
                
                const regionCounts = {};
                rawData.forEach(r => regionCounts[r.region] = (regionCounts[r.region]||0)+1);

                Object.keys(regionsData).forEach(rName => {
                    const rData = regionsData[rName];
                    const count = regionCounts[rName] || 0;
                    if(count === 0) return;

                    const el = document.createElement('div');
                    el.className = `bg-white p-5 rounded-xl border border-stone-100 shadow-sm hover:shadow-md hover:border-${rData.color}-300 cursor-pointer transition-all group`;
                    el.onclick = () => this.selectRegion(rName);
                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-stone-800 text-lg group-hover:text-${rData.color}-600 transition-colors">${rName}</h4>
                            <span class="bg-stone-100 text-stone-500 text-xs font-bold px-2 py-1 rounded">${count}</span>
                        </div>
                        <p class="text-xs text-stone-500 mb-3 line-clamp-2 min-h-[2.5em]">${rData.desc}</p>
                        <div class="text-xs font-medium text-stone-400 flex items-center">
                            <span class="mr-1">üìç</span> Hub: ${rData.hub}
                        </div>
                    `;
                    grid.appendChild(el);
                });
            },

            renderRegionDetail(rName) {
                const rData = regionsData[rName];
                const spots = rawData.filter(i => i.region === rName);

                document.getElementById('region-title').innerText = rName;
                document.getElementById('region-desc').innerText = rData.desc;
                document.getElementById('hub-city').innerText = rData.hub;
                document.getElementById('region-tag').innerText = `${spots.length} Lieux`;
                document.querySelectorAll('.hub-name-span').forEach(e => e.innerText = rData.hub);

                const list = document.getElementById('activities-list');
                list.innerHTML = '';

                spots.forEach(spot => {
                    const el = document.createElement('div');
                    el.className = "bg-white border border-stone-100 rounded-lg p-4 flex gap-4 hover:border-indigo-200 transition-colors";
                    el.innerHTML = `
                        <div class="flex-shrink-0 w-12 h-12 bg-stone-50 rounded-full flex items-center justify-center text-2xl">
                            ${this.getEmoji(spot.type)}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h4 class="font-bold text-stone-800 truncate pr-2">${spot.name}</h4>
                                <span class="text-xs font-bold text-amber-500 flex items-center bg-amber-50 px-1.5 py-0.5 rounded">‚òÖ ${spot.rating}</span>
                            </div>
                            <p class="text-xs text-stone-500 mt-1 mb-2 line-clamp-2 leading-relaxed">${spot.desc}</p>
                            <div class="flex flex-wrap gap-2 text-[10px] font-medium uppercase tracking-wide text-stone-400">
                                <span class="bg-stone-50 px-2 py-1 rounded">‚è± ${spot.time} min</span>
                                <span class="bg-stone-50 px-2 py-1 rounded">üöå ${spot.transport || 'Local'}</span>
                            </div>
                        </div>
                    `;
                    list.appendChild(el);
                });

                this.renderChart(spots);
            },

            getEmoji(type) {
                if(/nature|jardin|grotte/i.test(type)) return 'üåø';
                if(/temple|sanctuaire/i.test(type)) return '‚õ©Ô∏è';
                if(/ville|shopping|geek/i.test(type)) return 'üèôÔ∏è';
                if(/eau|volcan|onsen|√Æle/i.test(type)) return 'üåä';
                if(/histoire|mus√©e/i.test(type)) return 'üìú';
                return 'üìç';
            },

            renderOverviewChart() {
                const ctx = document.getElementById('overviewChart').getContext('2d');
                const counts = {};
                rawData.forEach(r => counts[r.region] = (counts[r.region]||0)+1);
                
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(counts),
                        datasets: [{
                            data: Object.values(counts),
                            backgroundColor: ['#4f46e5', '#0ea5e9', '#8b5cf6', '#f59e0b', '#14b8a6', '#f43f5e', '#f97316', '#ef4444', '#10b981', '#22c55e', '#64748b', '#06b6d4', '#78716c', '#84cc16', '#d946ef'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        cutout: '70%'
                    }
                });
            },

            renderChart(spots) {
                const ctx = document.getElementById('logisticsChart').getContext('2d');
                const sorted = [...spots].sort((a,b) => a.time - b.time);
                
                if(window.myBarChart) window.myBarChart.destroy();

                window.myBarChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sorted.map(s => s.name.substring(0, 15) + (s.name.length>15?'...':'')),
                        datasets: [{
                            label: 'Temps (min)',
                            data: sorted.map(s => s.time),
                            backgroundColor: sorted.map(s => s.time <= 60 ? '#10b981' : s.time <= 120 ? '#f59e0b' : '#f43f5e'),
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { beginAtZero: true } }
                    }
                });
            }
        };

        app.init();
    </script>
</body>
</html>